<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>SentIQ</title>
  <style>
    :root{
      --bg:#f6fbff; --card:#ffffff; --accent:#0b67ff; --muted:#5b6770;
      --radius:14px; --gap:14px; --shadow:0 10px 30px rgba(9,25,55,0.06);
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, 'Segoe UI', Roboto, Arial;
    }
    html,body{height:100%;margin:0;background:linear-gradient(180deg,#f7fbff 0%, #eef6ff 60%);color:#0f172a}
    .page{min-height:100vh;display:flex;align-items:center;justify-content:center;padding:36px}

    /* layout */
    .shell{width:min(980px,94%);display:grid;grid-template-columns:1fr 340px;gap:22px}

    /* left panel (chat) */
    .panel{background:var(--card);border-radius:18px;box-shadow:var(--shadow);padding:18px;display:flex;flex-direction:column;min-height:540px}
    .topbar{display:flex;align-items:center;justify-content:center;gap:12px;margin-bottom:10px}
    .brand{display:flex;align-items:center;gap:12px}
    .logo{width:44px;height:44px;border-radius:10px;background:linear-gradient(135deg,#e6f4ff, #eef8ff);display:grid;place-items:center;box-shadow:inset 0 -6px 18px rgba(11,103,255,0.06)}
    .logo svg{width:26px;height:26px}
    .title{font-weight:700;font-size:15px}
    .subtitle{font-size:13px;color:var(--muted)}

    /* greetinh */
    .greeting-wrap{display:flex;justify-content:center;margin:8px 0 14px}
    .greeting{
      background:linear-gradient(90deg,#fff,#f7fbff);
      padding:10px 18px;border-radius:999px;box-shadow:0 6px 18px rgba(11,103,255,0.06);
      font-weight:600;color:var(--accent);min-width:260px;text-align:center;
      display:inline-block;position:relative;
    }
    .greeting .caret{display:inline-block;width:8px;height:12px;background:var(--accent);margin-left:6px;vertical-align:middle;border-radius:2px;opacity:0;animation:blink 1s steps(2) infinite;}
    @keyframes blink{50%{opacity:1}100%{opacity:0}}

    .messages{flex:1;overflow:auto;padding:12px;border-radius:12px;background:linear-gradient(180deg, rgba(255,255,255,0.9), rgba(255,255,255,0.85));margin-bottom:12px}
    .msg{display:flex;gap:12px;margin-bottom:12px}
    .msg.user{justify-content:flex-end}
    .bubble{max-width:78%;padding:10px 14px;border-radius:12px;background:#ffffff;box-shadow:0 6px 18px rgba(15,23,42,0.04);color:#0f172a}
    .bubble.user{background:linear-gradient(180deg,#0b67ff,#1a86ff);color:white}

    .controls{display:flex;gap:10px;align-items:center}
    textarea#prompt{flex:1;min-height:64px;resize:vertical;padding:12px;border-radius:12px;border:1px solid #e9f1ff;background:transparent;font-size:14px}
    button#send{background:var(--accent);color:white;border:0;padding:12px 16px;border-radius:12px;font-weight:600;cursor:pointer;box-shadow:0 6px 18px rgba(11,103,255,0.08)}
    .small{font-size:13px;color:var(--muted)}

    /* right side */
    .side{background:linear-gradient(180deg,#ffffff,#fbfeff);border-radius:16px;padding:16px;box-shadow:var(--shadow);height:fit-content}
    .section{margin-bottom:12px}
    .section h4{margin:0 0 8px 0;font-size:14px}
    label.switch{display:flex;align-items:center;gap:8px}
    input[type=checkbox]{width:44px;height:24px;appearance:none;background:#eaf3ff;border-radius:999px;position:relative;outline:none;cursor:pointer}
    input[type=checkbox]:checked{background:linear-gradient(90deg,var(--accent),#47a3ff)}
    input[type=checkbox]::after{content:'';position:absolute;top:3px;left:4px;width:18px;height:18px;border-radius:50%;background:white;transition:0.18s}
    input[type=checkbox]:checked::after{transform:translateX(20px)}

    .quick-list{display:flex;flex-direction:column;gap:8px}
    .quick{background:#f3fbff;border:1px solid #e6f8ff;padding:10px;border-radius:10px;cursor:pointer;color:var(--accent);font-weight:600}

    .footer{font-size:12px;color:var(--muted);text-align:center;margin-top:8px}

    @media(max-width:920px){.shell{grid-template-columns:1fr;}.side{order:2}}
  </style>
</head>
<body>
  <div class="page">
    <div class="shell">

      <div class="panel" aria-live="polite">
        <div class="topbar">
          <div class="brand" style="display:flex;align-items:center;gap:10px">
            <div class="logo" aria-hidden>
              <!-- minimal cap+chat mark -->
              <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M12 2L3 7l9 5 9-5-9-5z" fill="#0B67FF" opacity="0.98"/>
                <path d="M4 17c0-2.2 3.2-3.8 8-3.8s8 1.6 8 3.8v.8H4v-.8z" fill="#0B67FF" opacity="0.12"/>
              </svg>
            </div>
            <div>
              <div class="title">SentIQ</div>
            </div>
          </div>
        </div>

        <!-- greeting with typing animation -->
        <div class="greeting-wrap" aria-hidden>
          <div class="greeting" id="greetingTxt"><span id="greet"></span><span class="caret"></span></div>
        </div>

        <div id="messages" class="messages" role="log"></div>

        <div class="controls">
          <textarea id="prompt" placeholder="Ask anything..." aria-label="Prompt"></textarea>
          <div style="display:flex;flex-direction:column;gap:8px;">
            <button id="send">Send</button>
            <div style="display:flex;gap:6px;align-items:center;justify-content:flex-end"><span class="small">Sim: <strong style="color:var(--muted)">safe</strong></span></div>
          </div>
        </div>
      </div>

      <div class="side" aria-hidden>
        <div class="section">
          <h4>Settings</h4>
          <label class="switch"><input type="checkbox" id="simToggle" checked><span class="small">Simulation (safe)</span></label>
        </div>

        <div class="section">
          <h4>Quick prompts</h4>
          <div class="quick-list">
            <button class="quick">Summarize this text</button>
            <button class="quick">Explain like I'm 5</button>
            <button class="quick">Debug this code</button>
          </div>
        </div>

        <div class="footer">Sounak Poddar • SynthetIQ</div>
      </div>

    </div>
  </div>

<script>
  // typing greeting
  const greetEl = document.getElementById('greet');
  const greeting = "Hi :) How can I help today?";
  let i = 0;
  (function type(){ 
    if(i <= greeting.length){
      greetEl.textContent = greeting.slice(0, i++);
      setTimeout(type, 40);
    } else {
      // small pause then stop caret blink by lowering opacity
      setTimeout(()=>{ document.querySelector('.greeting .caret').style.opacity = '0'; }, 800);
    }
  })();

  // core chat UI
  const messagesEl = document.getElementById('messages');
  const promptEl = document.getElementById('prompt');
  const sendBtn = document.getElementById('send');
  const simToggle = document.getElementById('simToggle');

  function appendMessage(text, cls='bot'){
    const wrap = document.createElement('div');
    wrap.className = 'msg ' + (cls==='user' ? 'user' : 'bot');
    const b = document.createElement('div');
    b.className = 'bubble ' + (cls==='user' ? 'user' : '');
    b.textContent = text;
    wrap.appendChild(b);
    messagesEl.appendChild(wrap);
    messagesEl.scrollTop = messagesEl.scrollHeight;
  }

  async function sendPrompt(){
    const prompt = promptEl.value.trim();
    if(!prompt) return;
    appendMessage(prompt,'user');
    promptEl.value='';

    const use_sim = simToggle.checked;
    appendMessage('Thinking...','bot');
    const lastBot = messagesEl.querySelector('.msg.bot:last-child .bubble');

    try{
      const res = await fetch('/api/llm', {
        method:'POST',headers:{'Content-Type':'application/json'},
        body: JSON.stringify({ prompt, category: 'general', use_simulation: use_sim })
      });

      if(!res.ok){
        const txt = await res.text();
        lastBot.textContent = 'Error: ' + (txt || res.statusText);
        return;
      }

      const data = await res.json();
      const answer = data.answer ?? data.text ?? data.result ?? JSON.stringify(data);
      lastBot.textContent = answer;
    }catch(err){
      lastBot.textContent = 'Network error — open console for details.';
      console.error(err);
    }
  }

  sendBtn.addEventListener('click', sendPrompt);
  promptEl.addEventListener('keydown', e=>{ if(e.key === 'Enter' && !e.shiftKey){ e.preventDefault(); sendPrompt(); } });

  // quick prompt buttons
  document.querySelectorAll('.quick').forEach(btn=>btn.addEventListener('click', ()=>{ promptEl.value = btn.textContent; promptEl.focus(); }));
  
  // initial ping (if backend missing show a simple note)
  (async ()=>{
    try{
      const ping = await fetch('/api/ping');
      if(!ping.ok) appendMessage('Tip: To enable real AI responses switch off the simulation mode. ','bot');
    }catch(e){
      appendMessage('Tip: To enable real AI responses switch off the simulation mode. ','bot');
    }
  })();
</script>
</body>
</html>