<!DOCTYPE html>
<html lang="en" data-theme="dark" data-ui-mode="desktop">
<head>
  <meta charset="UTF-8" />
  <title>SentIQ Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    :root {
      --nav-height: 64px;
      --radius: 16px;
      --transition: 0.25s ease;
      --gradient: linear-gradient(90deg,#ff4fd8,#7a5cff,#3b82f6);
    }

    :root[data-theme="dark"] {
      --bg:#0b0f1a;
      --card:rgba(255,255,255,0.05);
      --border:rgba(255,255,255,0.08);
      --text:#e5e7eb;
      --muted:#9ca3af;
    }

    :root[data-theme="light"] {
      --bg:#f8dacc;
      --card:rgba(255,255,255,0.9);
      --border:rgba(0,0,0,0.08);
      --text:#0b1220;
      --muted:#4b5563;
    }

    * { box-sizing:border-box; }

    body {
      margin:0;
      font-family:-apple-system,BlinkMacSystemFont,Inter,system-ui;
      background:var(--bg);
      color:var(--text);
      padding-top:var(--nav-height);
    }

    /* ---------- NAV ---------- */
    .top-nav {
      position:fixed;
      inset:0 0 auto 0;
      height:var(--nav-height);
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding:0 18px;
      backdrop-filter:blur(8px);
      background:linear-gradient(180deg,rgba(0,0,0,0.18),rgba(0,0,0,0.04));
      border-bottom:1px solid var(--border);
      z-index:50;
    }

    .nav-buttons { display:flex; gap:10px; align-items:center; }
    .nav-buttons a,.nav-buttons button {
      background:transparent;
      border:none;
      color:var(--text);
      font-weight:600;
      padding:8px 12px;
      border-radius:10px;
      cursor:pointer;
    }
    .nav-buttons a:hover,.nav-buttons button:hover {
      background:rgba(255,255,255,0.06);
    }
   
    

    /* ---------- LAYOUT ---------- */
    .container {
      max-width:1200px;
      margin:auto;
      padding:32px;
    }

    h1 { font-size:32px; margin:0 0 24px; }

    /* ---------- CARDS ---------- */
    .card {
      background:var(--card);
      border:1px solid var(--border);
      border-radius:var(--radius);
      padding:22px;
      margin-bottom:22px;
      backdrop-filter:blur(14px);
    }

    html[data-ui-mode="desktop"] .card {
      background:transparent;
      border:none;
      padding:8px 0;
    }
      

    /* ---------- TABLE ---------- */
    table {
      width:100%;
      border-collapse:collapse;
    }

    th {
      text-align:left;
      font-size:11px;
      text-transform:uppercase;
      color:var(--muted);
      padding-bottom:10px;
    }

    td {
      padding:14px 8px;
      border-bottom:1px solid rgba(255,255,255,0.06);
    }

    tr:hover {
      background:rgba(255,255,255,0.04);
      cursor:pointer;
    }

    .badge {
      padding:6px 12px;
      border-radius:999px;
      font-size:12px;
      font-weight:600;
    }

    .interview { background:rgba(34,197,94,0.15); color:#22c55e; }
    .hold { background:rgba(234,179,8,0.15); color:#eab308; }
    .reject { background:rgba(239,68,68,0.15); color:#ef4444; }

    /* ---------- SPLASH ---------- */
    .splash-overlay {
      position:fixed;
      inset:0;
      background:var(--bg);
      display:flex;
      align-items:center;
      justify-content:center;
      flex-direction:column;
      gap:18px;
      z-index:9999;
      transition:opacity 0.6s ease;
    }
    .splash-overlay.hidden {
      opacity:0;
      pointer-events:none;
    }

    .spiral {
      width:64px;
      height:64px;
      border-radius:50%;
      background:conic-gradient(from 0deg,#7a5cff,#ff4fd8,#3b82f6,#7a5cff);
      mask:radial-gradient(circle at center,transparent 40%,black 41%);
      -webkit-mask:radial-gradient(circle at center,transparent 40%,black 41%);
      animation:spin 1s linear infinite;
    }
    @keyframes spin { to { transform:rotate(360deg); } }
  </style>
</head>

<body>

<!-- SPLASH -->
<div class="splash-overlay" id="splashOverlay">
  <div class="spiral"></div>
</div>

<!-- NAV -->
<div class="top-nav">
  <strong>SentIQ</strong>
  <div class="nav-buttons">
    <a href="/upload">Upload</a>
    <a href="/dashboard">Dashboard</a>
    <a href="/api/export/candidates">Export</a>
    <button id="themeToggle">üåô</button>
  </div>
</div>
<div style="display:flex; gap:10px; align-items:center; margin-bottom:20px; padding:0 32px;">
  <button id="clearBtn" style="background:rgba(239,68,68,0.2); color:#ef4444; border:1px solid rgba(239,68,68,0.4); padding:10px 16px; border-radius:10px; cursor:pointer; font-weight:600; transition:all 0.2s ease;" onmouseover="this.style.background='rgba(239,68,68,0.3)'" onmouseout="this.style.background='rgba(239,68,68,0.2)'">üóëÔ∏è Clear All Reports</button>
  <span id="timezoneInfo" style="color:var(--muted); font-size:12px;"></span>
</div>


<!-- CONTENT -->
<div class="container">
  <h1>Dashboard</h1>

  <div class="card">
    <table id="candidates">
      <thead>
        <tr>
          <th>ID</th>
          <th>Score</th>
          <th>Decision</th>
          <th>Confidence</th>
          <th>Created</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <div class="card" id="details">
    <em>Select a candidate to view details.</em>
  </div>
</div>

<!-- SPLASH REMOVAL (ROBUST) -->
<script>
(function(){
  const overlay = document.getElementById("splashOverlay");
  if (!overlay) return;
  setTimeout(() => {
    overlay.classList.add("hidden");
    setTimeout(() => overlay.remove(), 700);
  }, 1000);
})();
</script>

<!-- DASHBOARD LOGIC -->
<script>
let allCandidates = [];

async function loadCandidates(){
  const res = await fetch("/api/dashboard/candidates");
  allCandidates = await res.json();
  renderTable(allCandidates);
}

function renderTable(data){
  const tbody = document.querySelector("#candidates tbody");
  tbody.innerHTML = "";
  data.forEach(c=>{
    const row = document.createElement("tr");
    const localTime = new Date(c.created_at).toLocaleString(undefined, {
      year: 'numeric',
      month: '2-digit',
      day: '2-digit',
      hour: '2-digit',
      minute: '2-digit',
      second: '2-digit'
    });
    row.innerHTML = `
      <td>${c.id}</td>
      <td>${c.score}</td>
      <td><span class="badge ${c.recommendation}">${c.recommendation}</span></td>
      <td>${c.confidence}</td>
      <td>${localTime}</td>
    `;
    row.onclick = () => loadDetails(c.id);
    tbody.appendChild(row);
  });
}

async function loadDetails(id){
  const res = await fetch(`/api/dashboard/candidate/${id}`);
  const c = await res.json();
  document.getElementById("details").innerHTML = `
    <h3>Candidate ${c.id}</h3>
    <p><strong>Score:</strong> ${c.score}</p>
    <p><strong>Pros:</strong> ${c.pros.join(", ")}</p>
    <p><strong>Cons:</strong> ${c.cons.join(", ")}</p>
    <p><strong>Decision:</strong> ${c.recommendation}</p>
    <pre>${c.resume_text}</pre>
  `;
}

// Detect and display user timezone
(function(){
  const tzInfo = document.getElementById("timezoneInfo");
  const tz = Intl.DateTimeFormat().resolvedOptions().timeZone;
  const now = new Date();
  const offset = -now.getTimezoneOffset() / 60;
  const offsetStr = offset >= 0 ? `+${offset}` : `${offset}`;
  tzInfo.textContent = `üìç ${tz} (UTC${offsetStr})`;
})();

loadCandidates();
</script>

<!-- THEME TOGGLE -->
<script>
(function(){
  const root=document.documentElement;
  const btn=document.getElementById("themeToggle");
  const saved=localStorage.getItem("sentiq-theme")||"dark";
  root.setAttribute("data-theme",saved);
  btn.textContent=saved==="dark"?"üåô":"‚òÄÔ∏è";
  btn.onclick=()=>{
    const next=root.getAttribute("data-theme")==="dark"?"light":"dark";
    root.setAttribute("data-theme",next);
    localStorage.setItem("sentiq-theme",next);
    btn.textContent=next==="dark"?"üåô":"‚òÄÔ∏è";
  };
})();
</script>
<script>
document.getElementById("clearBtn").onclick = async () => {
  if (!confirm("‚ö†Ô∏è This will PERMANENTLY delete all " + allCandidates.length + " reports and reset IDs. Continue?")) return;

  const res = await fetch("/api/dashboard/clear", { method: "POST" });
  if (res.ok) {
    allCandidates = [];
    renderTable([]);
    document.getElementById("details").innerHTML =
      "<em>Select a candidate to view details</em>";
    alert("‚úÖ All reports cleared and IDs reset.");
    loadCandidates();
  } else {
    alert("‚ùå Failed to clear reports.");
  }
};
</script>

</body>
</html>
